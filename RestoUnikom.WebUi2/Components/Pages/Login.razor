@page "/login"
@inject RestoUnikom.WebUi2.Authentication.CustomAuthenticationStateProvider AuthService
@inject NavigationManager Navigation
@inject MudBlazor.ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small" Class="py-4">
    <MudPaper Elevation="2" Class="pa-6">
        <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4">Login</MudText>
        <MudForm @ref="_form" @bind-IsValid="@_isValid">
            <MudTextField T="string" Label="Nama Pengguna" @bind-Value="_namaPengguna" Variant="Variant.Outlined" Required="true" Class="mb-4" />
            <MudTextField T="string" Label="Kata Sandi" @bind-Value="_kataSandi" Variant="Variant.Outlined" InputType="InputType.Password" Required="true" Class="mb-4" />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Disabled="@(!_isValid || _isProcessing)" OnClick="SubmitLogin">
                @if (_isProcessing)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                }
                Login
            </MudButton>
        </MudForm>
    </MudPaper>
</MudContainer>

@code {
    private MudForm _form = null!;
    private bool _isValid = false;
    private bool _isProcessing = false;
    private string _namaPengguna = string.Empty;
    private string _kataSandi = string.Empty;

    private async Task SubmitLogin()
    {
        _isProcessing = true;
        try
        {
            await AuthService.LoginAsync(_namaPengguna, _kataSandi);
            Snackbar.Add("Login berhasil!", Severity.Success);
            Navigation.NavigateTo("/pemesanan", forceLoad: true);
        }
        catch
        {
            Snackbar.Add("Nama pengguna atau kata sandi salah!", Severity.Error);
        }
        finally
        {
            _isProcessing = false;
        }
    }
}